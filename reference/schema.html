<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Ensure the truth of data-masked R expressions and cast/recycle named elements. — schema • favr</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ensure the truth of data-masked R expressions and cast/recycle named elements. — schema"><meta name="description" content="If any of the expressions in ..., evaluated within the data mask
'data' (see data masking), are not all TRUE, abort
is called for the first which was not (all) TRUE. Alternatively,
rlang formulas can
be used to take advantage of tidyselect
features and pass multiple named elements in data to validation
formulas/functions, and/or attempt safe type casting and size recycling
using the cast, recycle and coerce functions.
The rhs of formulas can be given in a list to pass multiple
functions/formulas/calls. The .names and .size arguments can also be used
to check for given names and size of the data.frame/list itself. Type
casting, size checking, and recycling are undertaken using the
vctrs package and thus apply
vctrs type and size rules."><meta property="og:description" content="If any of the expressions in ..., evaluated within the data mask
'data' (see data masking), are not all TRUE, abort
is called for the first which was not (all) TRUE. Alternatively,
rlang formulas can
be used to take advantage of tidyselect
features and pass multiple named elements in data to validation
formulas/functions, and/or attempt safe type casting and size recycling
using the cast, recycle and coerce functions.
The rhs of formulas can be given in a list to pass multiple
functions/formulas/calls. The .names and .size arguments can also be used
to check for given names and size of the data.frame/list itself. Type
casting, size checking, and recycling are undertaken using the
vctrs package and thus apply
vctrs type and size rules."><meta property="og:image" content="https://lj-jenkins.github.io/favr/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">favr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/LJ-Jenkins/favr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Ensure the truth of data-masked R expressions and cast/recycle named elements.</h1>
      <small class="dont-index">Source: <a href="https://github.com/LJ-Jenkins/favr/blob/main/R/schema.r" class="external-link"><code>R/schema.r</code></a></small>
      <div class="d-none name"><code>schema.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>If any of the expressions in <code>...</code>, evaluated within the data mask
<code>'data'</code> (see <a href="https://rlang.r-lib.org/reference/args_data_masking.html" class="external-link">data masking</a>), are not all <code>TRUE</code>, <a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">abort</a>
is called for the first which was not (<a href="https://rdrr.io/r/base/all.html" class="external-link">all</a>) <code>TRUE</code>. Alternatively,
<a href="https://rlang.r-lib.org/reference/new_formula.html" class="external-link">rlang formulas</a> can
be used to take advantage of <a href="https://tidyselect.r-lib.org/index.html" class="external-link">tidyselect</a>
features and pass multiple named elements in <code>data</code> to validation
formulas/functions, and/or attempt safe type casting and size recycling
using the <a href="favr_casting_recycling_helpers.html">cast</a>, <a href="favr_casting_recycling_helpers.html">recycle</a> and <a href="favr_casting_recycling_helpers.html">coerce</a> functions.
The rhs of formulas can be given in a <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> to pass multiple
functions/formulas/calls. The <code>.names</code> and <code>.size</code> arguments can also be used
to check for given names and size of the data.frame/list itself. Type
casting, size checking, and recycling are undertaken using the
<a href="https://vctrs.r-lib.org/" class="external-link">vctrs</a> package and thus apply
<a href="https://vctrs.r-lib.org/articles/type-size.html" class="external-link">vctrs type and size rules</a>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">schema</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'list'</span></span>
<span><span class="fu">schema</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .error_call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .darg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">schema</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .error_call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .darg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">enforce_schema</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'with_schema'</span></span>
<span><span class="fu">enforce_schema</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span>, .error_call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span>, .darg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">add_to_schema</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'with_schema'</span></span>
<span><span class="fu">add_to_schema</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  .names <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .error_call <span class="op">=</span> <span class="fu">caller_env</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  .darg <span class="op">=</span> <span class="fu">caller_arg</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data.frame or list to use as the data mask.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>any number of R expressions or formulas to be evaluated using
<code>data</code> as a data mask. Formulas can use tidyselect syntax
on the lhs and either functions or formulas that evaluate to logical, or one
of the type/size functions: <a href="favr_casting_recycling_helpers.html">cast</a>, <a href="favr_casting_recycling_helpers.html">recycle</a> and <a href="favr_casting_recycling_helpers.html">coerce</a>
on the rhs. The rhs of a formula can also be a <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a> of multiple
functions/formulas/calls. If an expression is named, or if the list
element on the rhs of a formula is named, the name is passed to
<a href="https://cli.r-lib.org/reference/format_inline.html" class="external-link">format_inline</a> and is used in the error message.</p></dd>


<dt id="arg--names">.names<a class="anchor" aria-label="anchor" href="#arg--names"></a></dt>
<dd><p>character vector of names which must be present in the <code>data</code>
data.frame/list.</p></dd>


<dt id="arg--size">.size<a class="anchor" aria-label="anchor" href="#arg--size"></a></dt>
<dd><p>positive scalar integerish value for the size that the <code>data</code>
data.frame/list must be.</p></dd>


<dt id="arg--error-call">.error_call<a class="anchor" aria-label="anchor" href="#arg--error-call"></a></dt>
<dd><p>the call environment to use for error messages
(passed to <a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">abort</a>).</p></dd>


<dt id="arg--darg">.darg<a class="anchor" aria-label="anchor" href="#arg--darg"></a></dt>
<dd><p>the argument name of <code>data</code> to use in error messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>data</code> is returned with attached class <code>with_schema</code> and
attribute <code>schema</code> containing the schema call to be enforced later.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>See <a href="abort_if_not.html">abort_if_not</a> for a non-data-masked validation tool and
<a href="enforce.html">enforce</a> for a non-data-masked version of this function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># NB: Some of these examples are expected to produce an error. To</span></span></span>
<span class="r-in"><span><span class="co">#     prevent them from terminating a run with example() they are</span></span></span>
<span class="r-in"><span><span class="co">#     piped into a call to try().</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1L</span>, y <span class="op">=</span> <span class="st">"hi"</span>, z <span class="op">=</span> \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="va">li</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">schema</span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">is.character</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/is.function.html" class="external-link">is.function</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="co"># all TRUE</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The schema call is attached to the returned object and</span></span></span>
<span class="r-in"><span><span class="co"># can be re-evaluated using enforce_schema():</span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu">enforce_schema</span><span class="op">(</span><span class="va">li</span><span class="op">)</span> <span class="co"># no error</span></span></span>
<span class="r-in"><span><span class="va">li2</span> <span class="op">&lt;-</span> <span class="va">li</span></span></span>
<span class="r-in"><span><span class="va">li2</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2L</span></span></span>
<span class="r-in"><span><span class="fu">enforce_schema</span><span class="op">(</span><span class="va">li2</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">Caused by error in `enforce_schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `x == 1`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Returned `FALSE`.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calling `schema()` again overwrites any existing schema.</span></span></span>
<span class="r-in"><span><span class="co"># Alternatively use `add_to_schema()` to add arguments to</span></span></span>
<span class="r-in"><span><span class="co"># an existing schema (.size overwrites, other args append):</span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="va">li</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">add_to_schema</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, .names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, .size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A custom error message can be given for each expression by</span></span></span>
<span class="r-in"><span><span class="co"># naming it:</span></span></span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>,</span></span>
<span class="r-in"><span>  <span class="st">"{.var y} must be {.cls numeric}, check input"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `is.numeric(y)`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> `y` must be <span style="color: #0000BB;">&lt;numeric&gt;</span>, check input</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Formulas can be used to take advantage of tidyselect features</span></span></span>
<span class="r-in"><span><span class="co"># on the lhs, with functions/additional formulas required on</span></span></span>
<span class="r-in"><span><span class="co"># the rhs:</span></span></span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>,</span></span>
<span class="r-in"><span>  <span class="st">"multiple columns: {.pkg tidyselect}"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">~</span> <span class="va">is.integer</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> For named element: `y`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `c(x, y) ~ is.integer`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> multiple columns: <span style="color: #0000BB;">tidyselect</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Formulas can also be used with `cast()`, `recycle()`, and</span></span></span>
<span class="r-in"><span><span class="co"># `coerce()` on the rhs to safely cast or recycle named</span></span></span>
<span class="r-in"><span><span class="co"># elements:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>, <span class="va">x</span> <span class="op">~</span> <span class="fu"><a href="favr_casting_recycling_helpers.html">cast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="co"># x is now numeric</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "numeric"</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>, <span class="va">x</span> <span class="op">~</span> <span class="fu"><a href="favr_casting_recycling_helpers.html">recycle</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="co"># x is now length 5</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">li</span>,</span></span>
<span class="r-in"><span>  <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="favr_casting_recycling_helpers.html">coerce</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">$</span><span class="va">y</span> <span class="co"># y is now factor and length 5</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] hi hi hi hi hi</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Levels: hi</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Multiple calls can be used with formulas by wrapping them</span></span></span>
<span class="r-in"><span><span class="co"># in `list()`, with the names of list elements being</span></span></span>
<span class="r-in"><span><span class="co"># preferentially chosen for error messaging and the error</span></span></span>
<span class="r-in"><span><span class="co"># message also showing which formula/function/call caused the</span></span></span>
<span class="r-in"><span><span class="co"># error:</span></span></span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">li</span>,</span></span>
<span class="r-in"><span>  <span class="st">"generic message"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.null</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="st">"{.var specific} message"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.function</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> For named element: `z`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `c(x, y, z) ~ list(... Negate(is.function) ...)`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> `specific` message</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Changed elements are available immediately:</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1L</span>, y <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">schema</span><span class="op">(</span><span class="va">df</span>, <span class="va">x</span> <span class="op">~</span> <span class="fu"><a href="favr_casting_recycling_helpers.html">cast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/double.html" class="external-link">double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="favr_casting_recycling_helpers.html">cast</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, <span class="va">class</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "numeric"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "numeric"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># both now numeric</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `.names` and `.size` arguments can be used to check that given</span></span></span>
<span class="r-in"><span><span class="co"># names are present and that the data has the desired size:</span></span></span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>, .names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Named elements `a` and `b` not found in data mask `li`.</span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>, .size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Object `li` is of <span style="color: #0000BB;">vctrs</span> size `3`, not `5`.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The `.error_call` argument can be used to specify where the</span></span></span>
<span class="r-in"><span><span class="co"># error occurs, by default this is the caller environment:</span></span></span>
<span class="r-in"><span><span class="va">myfunc</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu">schema</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">myfunc</span><span class="op">(</span><span class="va">li</span>, <span class="va">x</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in myfunc(li, x &gt; 4) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `x &gt; 4`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Returned `FALSE`.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># rlang pronouns and injection can be used, but care must be</span></span></span>
<span class="r-in"><span><span class="co"># taken when using `.env` and `enforce_schema()` as the</span></span></span>
<span class="r-in"><span><span class="co"># caller environment may have changed:</span></span></span>
<span class="r-in"><span><span class="va">msg</span> <span class="op">&lt;-</span> <span class="st">"{.var injection} msg"</span></span></span>
<span class="r-in"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">quote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">schema</span><span class="op">(</span><span class="va">li</span>, <span class="op">!</span><span class="op">!</span><span class="va">msg</span> <span class="op">:=</span> <span class="op">!</span><span class="op">!</span><span class="va">cols</span> <span class="op">~</span> <span class="va">is.integer</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : <span style="font-weight: bold;">Caused by error in `schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> For named element: `y`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `c(x, y) ~ is.integer`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> `injection` msg</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu">schema</span><span class="op">(</span><span class="va">li</span>, <span class="va">x</span> <span class="op">==</span> <span class="va">.env</span><span class="op">$</span><span class="va">x</span><span class="op">)</span> <span class="co"># no error</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="fu">enforce_schema</span><span class="op">(</span><span class="va">li</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># error as the environmental variable has changed</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Error in eval(expr, envir) : </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="font-weight: bold;">Caused by error in `enforce_schema()`</span>.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> In argument: `x == .env$x`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BBBB00;">!</span> Returned `FALSE`.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke Jenkins.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

